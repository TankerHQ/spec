# Features

This section describes the functional and access perimeters of the main features of the Tanker product.

All terms in italic refer to the terms defined in the [concepts](./concepts.md) section.

## Additional definitions

<dl>
  <dt>Customer</dt>
  <dd>Someone who is implementing the Tanker product inside a Tanker App</dd>
  <dt>Application server</dt>
  <dd>Backend infrastructure used by the <em>Tanker app</em></dd>
</dl>

##  Identity generation and management

### Functional perimeter

Identities are used by Tanker to represent *users*.

Thus, an identity is always required to start a session with a Tanker SDK.

Identities must be generated by the *application server*. Tanker provides an Identity SDK in several languages to help with this task.

Identities must be stored permanently by the *application server*.

A public identity can be obtained from an identity, and is required to share with a recipient.

## Access perimeter

The *application server* is responsible for serving identities to the corresponding *users*.

Assuming the client-server protocol to retrieve a permanent identity is robustly implemented in the *Tanker App* (i.e. an identity is only served to the corresponding authenticated user), this identity must only be accessible by:

* The *application server*
* The corresponding authenticated *user*

## Identity registration

### Functional perimeter

When a *user* starts a Tanker session for the first time, they must first register their identity. The *user* provides information, called the *verification method* (e.g. an email address), that is verified by Tanker and that will be used to register additional *devices*.

The *user* is then allowed to perform all operations available through the Tanker SDK (encrypt, decrypt, share…), and to be the recipient of such operations.

### Access perimeter

This identity registration may only be done with a Tanker identity (generated and served by the *application server*) that has not been already used in such an operation.

A registered *user* is only allowed to perform operations through the Tanker SDK from the *device* used in the identity registration step.

## Identity verification (multi-device)

### Functional perimeter

When a *user* is already registered on the *Trustchain* and uses a *new device*, that *device* must be registered too. This operation is performed through the *identity verification service* with *user*-provided information matching the one given at identity registration (the verification method).

This allows the *device* to decrypt any encrypted *data* shared with the *user* or the *user groups* they are part of.

### Access perimeter

This operation can for example be done with a *verification ke*y, which is usually stored on the *Tanker server*, protected by the *verification method* set up at the identity registration.

## Session tokens

### Functional perimeter

When a *user*  performs an *identity verification* they can also request a *session token*.
A *session token* can be used by the *application server* to verify that an *identity verification* took place, and also check what *verification method* was used.

This allows the *application server* to implement policies like multi-factor authentication.

### Access perimeter

This operation requires that the device generate a signed *session certificate* when performing *identity verification*. 
This signed *session certificate* is stored on the *Tanker server* and corresponds to the *session token*.

## Email verification method

### Functional perimeter

A *user* can register an email verification method to protect their *verification key*. This *verification method* can then be used to register other *devices* (as explained in the “Identity verification” section).

When a *user* needs to verify their identity, the *application server* will ask the *Tanker server* to send them an email containing a token which they must give back to Tanker to prove that they own the email address.

### Access perimeter

When using the *email verification method*, the *verification key* is stored encrypted on the Tanker server. *Users* need access to their identity to decrypt it.

Access to the email sent by the *Tanker server* is sufficient to retrieve the email token that grants access to the encrypted *verification key*. In other words, entities such as, but not limited to, the person who owns the email account, the email provider, or our email sending service may have access to this token.

Only the *user* must be able to authenticate to the *application server*, retrieve their identity, and use it to decrypt their *verification key*.

## Phone number verification method

### Functional perimeter

A *user* can register a phone number verification method to protect their *verification key*. This *verification method* can then be used to register other *devices* (as explained in the “Identity verification” section).

When a *user* needs to verify their identity, the *application server* will ask the *Tanker server* to send them a SMS containing a token which they must give back to Tanker to prove that they own the phone number.

### Access perimeter

When using the *phone number verification method*, the *verification key* is stored encrypted on the Tanker server. *Users* need access to their identity to decrypt it.

Access to the SMS sent by the *Tanker server* is sufficient to retrieve the SMS token that grants access to the encrypted *verification key*. In other words, entities such as, but not limited to, the person who owns the phone number, the SMS provider may have access to this token.

Only the *user* must be able to authenticate to the *application server*, retrieve their identity, and use it to decrypt their *verification key*.

## Groups

### Functional perimeter

*Users* can create *groups of users* to share *data* with a collection of users.

It is possible to create and add more members to a *group* later on.

It is also possible to remove members from groups, though this is only done by access control and has no cryptographic guarantees.

### Access perimeter

Any *user* can create a *group*.

Only members of the *group* can add or remove other *group* members.

## Data encryption

### Functional perimeter

* Encrypting data that will be decryptable by the specified recipients (often, including the user themselves).
* Decrypting data for which the user is a specified recipient.
* Sharing data *resource keys* with specified recipients.

## Access perimeter

### Clear and encrypted application data

The *Tanker server* never access or interact with clear or encrypted application data.

### Resource keys

Optionally, the *user* can share the resource keys with additional recipients:

* One or more *users*
* One or more *groups*

Thus, an encrypted piece of data may be decrypted by its author, and the users (including groups members) with whom it has been shared.

On the other hand, any of the following actors cannot single-handedly decrypt a piece of encrypted *data*:

* Tanker
* Tanker’s subcontractors (e.g. cloud provider)
* The *application server*
* The *customer*
* The *customer*’s subcontractors (e.g. cloud provider)
* An attacker on the *Tanker server*
* An attacker on the *application server*

## Pre-registration

### Functional perimeter

A *user* can share data with another *user* who is not registered on the *application server* or on the *Trustchain* yet. Such a recipient is identified by their email address.

The *application server* must store a provisional identity for each provisional *user* to be shared with.

### Access perimeter

The *application server* must ensure (e.g. with a similar challenge to the *email verification method*) that the *user* is the legitimate owner of the specified email address before giving them access to the provisional identity.

The *Tanker server* will uphold the same security guarantees.

Note however that entities with access to the *user*’s email may also complete the challenge, similarly to the email verification process.

In particular these entities may have access to any resource keys shared with the provisional identity or any *group* it is part of.

## Upload and download

### Functional perimeter

Provided the *customer* has configured a custom Amazon S3 or Google Cloud Storage bucket on their Trustchain, the Tanker SDK allows their users to:

* Encrypt and upload *data* to that bucket
* Download and decrypt *data* from that bucket

### Access perimeter

Since these APIs are layered over the encryption and decryption APIs, they share the access perimeter described in the “Data encryption” section.

Additionally, note that the bucket provider may access encrypted *data*.
